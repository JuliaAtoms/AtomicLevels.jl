```@meta
DocTestSetup = :(using AtomicLevels)
```

# [Atomic configuration state functions (CSFs)](@id CSFs)

AtomicLevels also provides types to represent symmetry-adapted atomic states, commonly referred to as [configuration state functions (CSFs)](https://en.wikipedia.org/wiki/Configuration_state_function). These are linear combinations of Slater determinants arising from a particular _configuration_, that are also
eigenstates of the angular momentum.

## Background

When constructing a basis for many-body atomic states, you start from a set of single-particle states (orbitals) and form anti-symmetric many-particle product states (Slater determinants) of any particle number. Superpositions of these Slater determinants can then represent full many-electron wavefunctions. In principle, if the set of one-particle orbitals is complete, the set of all Slater determinants would form a complete many-particle basis.

However, even if your orbitals are angular momentum eigenstates, the Slater determinants formed out of these orbitals in general are not. As angular momentum symmetry is a useful symmetry to adhere to when working with atomic states, this is where CSFs come in. They form a _symmetry adapted_ many body basis, representing the same many-particle space, but each state is now also an eigenstate of angular momentum. They are related to the underlying Slater determinats via a basis transformation.

!!! note "Other symmetries"

    You can also imagine CSFs that are adapted to other symmetries. However, at this stage, AtomicLevels only supports CSFs adapted to angular momentum.

### Forming a CSF

In AtomicLevels, CSFs are represented with the [`CSF`](@ref) type. An instance of a [`CSF`](@ref) only specifies the CSFs up to the total angular momentum (i.e. it actually represent a set of states corresponding to the different possible ``J_z`` quantum numbers).

The starting point for a CSF is a configuration, i.e. a list of orbitals and their occupations (how many electrons in the orbital). Each configuration corresponds to a set of Slater determinants, generated by considering all the possible combinations of `m` quantum numbers of the orbitals.

The next step is to couple each subshell into angular momentum eigenstates. This is, in principle, similar to how you can use the [Clebch-Gordan coefficients](https://en.wikipedia.org/wiki/Clebsch%E2%80%93Gordan_coefficients) ``C_{j_1m_1j_2m_2}^{j_3m_3}`` to couple products states of angular momentum eigenstates, which themselves in general are not eigenstates of total angular momentum, into angular momentum eigenstates by creating superpositions with appropriate coefficients. The general formula is

```math
\ket{j_3 m_3} = \sum_{m_1,m_2,m_3}
C_{j_1m_1j_2m_2}^{j_3m_3}
\ket{j_1 m_1} \ket{j_2 m_2}
```

where valid ``j_3`` values are ``|j_1 - j_2| \leq j_3 \leq j_1 + j_2``.

However, when dealing with fermionic particles, you have to account for the fact that due to the anti-symmetry of the many-electron states under particle exchange, only a subset of products are valid or unique many-electron states. Hence, determining the resulting ``J`` (or ``L`` and ``S`` in ``LS``-coupling) eigenvalues and the coupling coefficients is non-trivial.

AtomicLevels has methods to determine the subshell term symbols for both relativistic and non-relativistic orbitals (see [Term symbols](@ref)):

```jldoctest
julia> terms(ro"3d", 3)
3-element Array{HalfIntegers.Half{Int64},1}:
 3/2
 5/2
 9/2

julia> terms(o"2p", 3)
3-element Array{Term,1}:
 ²Pᵒ
 ²Dᵒ
 ⁴Sᵒ
```

So, the second step in defining a CSFs is defining the coupled states of each of the subshells in the configuration ("intermediate terms").

It turns out if you go to high enough angular momenta of the orbital and high enough particle number, the angular momentum eigenvalues are no longer sufficient to uniquely identify coupled states:

```jldoctest
julia> terms(ro"4f", 4)
8-element Array{HalfIntegers.Half{Int64},1}:
 0
 2
 2
 4
 4
 5
 6
 8
```

So for non-relativistic configurations, AtomicLevels stores the subshell couplings as instances of the [`IntermediateTerm`](@ref) type, which contains the ``L`` and ``S`` eigenvalues, but also an additional _seniority_ quantum number, which can be used to distinguish these degenerate subshell spaces.

!!! note "Limitations of AtomicLevels"

    AtomicLevels currently has a few limitations:

    * The extra quantum number in [`IntermediateTerm`](@ref) for CSFs based on non-relativistic configurations is assume to be the _seniority_ number. However, the seniority number is not enough to uniquely define a subshell state if you go to high enough particle number and angular momentum.
    * Subshell couplings for relativistic configurations are only stored as integer or half-integer values and hence not able to describe the the degenerate subshell spaces at all.

Finally, once the electrons on individual subshells are coupled, we can couple the subshells themselves together. As the orbitals in a subshell are distinct from the ones in other subshells, this can easily be done with just Clebch-Gordan coefficients.

In AtomicLevels, we assume that the coupling is done by starting from the leftmost orbital pair, coupling those subshells together. Then the coupled two subshells are taken and coupled to the next subshells, and so on. In the end, we get a coupling tree that looks something like this:

![](couplingtree.svg)

The total angular momenta of the last coupling (``J_{1:k}``) determines the angular momentum of the whole CSF.

## Coupling schemes

How the coupling of orbitals into CSFs

AtomicLevels currently supports representing CSFs in the following two schemes:

### ``LS``-coupling

In ``LS``-coupling, each orbital must be a of [`Orbital`](@ref), specified by its ``n`` and ``\ell`` quantum numbers. Implicitly, each orbital also has a spin values of ``s = 1/2``.

When coupling is performed, the ``L`` and ``S`` spaces are coupled separately. This is possible because the spaces are orthogonal.

This means that each subshell term is represented by an ``L`` and ``S`` values, together with the seniority number. Intra-subshell couplings are defined by the ``L`` and ``S`` values.

The final CSF in ``LS``-coupling does not define a ``J`` value, i.e. AtomicLevels currently does not perform ``LSJ``-coupling.

### ``jj``-coupling

``jj``-coupling is used for [`RelativisticOrbital`](@ref)s, where each orbital
only has the total angular momentum value ``J``. In this coupling scheme, only the ``J`` values coupled. Intermediate terms are the ``J`` values, together with seniority, and the intra-shell couplings are determined according to the ``J`` value.

## Reference

```@docs
CSF
```

```@meta
DocTestSetup = nothing
```
